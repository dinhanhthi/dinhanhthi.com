{#
  Parameters:
  - postslist
  - morePosts
  - customClass (string)
  - sortBy ('date')
  - limitPosts (number)
  - customIcon (boolean)
  - hideBlogPosts (boolean)
#}

<div class="toggle-posts{% if customClass %} {{ customClass }}{% endif %}">

  {% set newPostList = [] %}
  {% for post in postslist %}
    {% set singlePost = {
      'title': post.data.title,
      'url': post.url,
      'date': post.date,
      'isBlog': post.data.tags | isBlog
    } %}
    {% if post.data.notfull %}
      {% set singlePost = singlePost | setAttribute('notfull', post.data.notfull) %}
    {% endif %}
    {% if post.data.lowQuality %}
      {% set singlePost = singlePost | setAttribute('lowQuality', post.data.lowQuality) %}
    {% endif %}
    {% if post.data.private %}
      {% set singlePost = singlePost | setAttribute('private', post.data.private) %}
    {% endif %}
    {# {% if post.data.good %}
      {% set singlePost = singlePost | setAttribute('good', post.data.good) %}
    {% endif %} #}
    {% if not post.data.hide %}
      {% set newPostList = (newPostList.push(singlePost), newPostList) %}
    {% endif %}
    {% if post.data.part %}
      {% set singlePost = singlePost | setAttribute('part', post.data.part) %}
    {% endif %}
    {% if post.data.partName %}
      {% set singlePost = singlePost | setAttribute('partName', post.data.partName) %}
    {% endif %}
  {% endfor %}

  {% if morePosts %}
    {% for post in morePosts %}
      {% set singlePost = {
        'title': post.title,
        'url': post.url,
        'target': "_blank",
        'external': true,
        'date': post.date,
        'isBlog': post.tags | isBlog
      } %}
      {% if post.notfull %}
        {% set singlePost = singlePost | setAttribute('notfull', post.notfull) %}
      {% endif %}
      {% if post.lowQuality %}
        {% set singlePost = singlePost | setAttribute('lowQuality', post.lowQuality) %}
      {% endif %}
      {% if post.private %}
        {% set singlePost = singlePost | setAttribute('private', post.private) %}
      {% endif %}
      {% if not post.hide %}
        {% set newPostList = (newPostList.push(singlePost), newPostList) %}
      {% endif %}
      {% if post.part %}
        {% set singlePost = singlePost | setAttribute('part', post.part) %}
      {% endif %}
      {% if post.partName %}
        {% set singlePost = singlePost | setAttribute('partName', post.partName) %}
      {% endif %}
    {% endfor %}
  {% endif %}

  {% if sortBy == 'date' %}
    {% set newPostList = newPostList | sort(attribute = 'date') | reverse %}
  {% else %}
    {% set newPostList = newPostList | sort(attribute = 'title') %}
  {% endif %}

  {% if limitPosts %}
    {% set newPostList = newPostList | head(limitPosts) %}
  {% endif %}

  {% for post in newPostList %}
    {% if not hideBlogPosts or not post.isBlog  %}
      {% if post.target %}
        {% set target = post.target %}
      {% else %}
        {% set target = "_self" %}
      {% endif%}

      {# ðŸ‘‹ a tag around #}
      {% if 'list-of-blog' in customClass %}
        <a href="{{ post.url | url }}" rel="noopener noreferrer" target="{{ target }}">
      {% endif %}

      <div class="post-item
        {% if not post.isBlog %}
          {% if post.notfull or post.lowQuality %} post-not-full{% endif %}
          {% if post.private %} post-private{% endif %}
          {% if post.external %} post-outside{% endif %}
        {% endif %}
        {% if 'list-of-blog' in customClass %} _blog-card{% endif %}
      ">
        {% if customIcon %}
          {% if post.isBlog %}
            {% set blogItem = categories | getBlog %}
            <i class="{{ blogItem.fontello }} fontello-icon" style="color: {{ blogItem.color }};"></i>
          {% else %}
            {% if not post.external %}
              <i class="icon-doc fontello-icon"></i>
            {% else %}
              <i class="icon-doc-add fontello-icon"></i>
            {% endif %}
          {% endif %}
        {% endif %}

        {% if not 'list-of-blog' in customClass %}
          <a href="{{ post.url | url }}" rel="noopener noreferrer" target="{{ target }}">
        {% endif %}

        {% if post.title %}
          <span class="card-title">
            {{ post.title }}

            {# ðŸ‘‹ Don't show draft/private/good indicator for blog posts #}
            {% if not post.isBlog %}
              {# {% if post.good %}
                <sup title="{{ other_data.good }}" style="color: #ffc50b;">â­‘</sup>
              {% endif %} #}
              {% if post.notfull or post.lowQuality %}
                <sup title="{{ other_data.notfull }}">â€¢</sup>
              {% endif %}
              {% if post.private %}
                <sup title="{{ other_data.private }}">â€ </sup>
              {% endif %}
            {% endif %}
            {% if post.part %}
              <span class="post-part-card">{{ post.part }}</span>
            {% endif %}
          </span>

          {% if post.partName %}
            <div class="post-part-name">{{ post.partName }}</div>
          {% endif %}

          {% if 'list-of-blog' in customClass %}
            <div class="bottom-wave">
              <svg
                class="waves"
                preserveAspectRatio="none"
                shape-rendering="auto"
                viewBox="0 24 150 28"
                xmlns="http://www.w3.org/2000/svg"
                xmlns:xlink="http://www.w3.org/1999/xlink"
              >
                <defs>
                  <path
                    d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"
                    id="gentle-wave"
                  ></path>
                </defs>
                <g class="parallax">
                  <use fill="{{ post.title | getRandomColor(loop.index0, 0) }}" x="48" xlink:href="#gentle-wave" y="0"></use>
                  <use fill="{{ post.title | getRandomColor(loop.index0, 1) }}" x="48" xlink:href="#gentle-wave" y="3"></use>
                  <use fill="{{ post.title | getRandomColor(loop.index0, 2) }}" x="48" xlink:href="#gentle-wave" y="5"></use>
                  <use fill="{{ post.title | getRandomColor(loop.index0, 3) }}" x="48" xlink:href="#gentle-wave" y="7"></use>
                </g>
              </svg>
            </div>
          {% endif %}
        {% else %}
          <code>{{ post.url }}</code>
          {% if post.notfull or post.lowQuality %}
            <sup title="{{ other_data.notfull }}">â€¢</sup>
          {% endif %}
          {% if post.private %}
            <sup title="{{ other_data.private }}">â€ </sup>
          {% endif %}
        {% endif %}

        {% if not 'list-of-blog' in customClass %}
          </a>{% if post.date and showDate %} â€” <span class="last-modified">updated {{ post.date | toDuration }}</span>{% endif %}
        {% endif %}
      </div>

      {# a tag around #}
      {% if 'list-of-blog' in customClass %}
        </a>
      {% endif %}

      {# <time  datetime="{{ post.date | htmlDateString }}">{{ post.date | readableDate }}</time> #}
    {% endif %}
  {% endfor %}
</div>